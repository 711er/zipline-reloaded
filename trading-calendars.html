
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trading Calendars &#8212; Zipline 2.0.0post1 documentation</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/zipline.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Metrics" href="risk-and-perf-metrics.html" />
    <link rel="prev" title="Data" href="bundles.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="index.html">
<p class="title">Zipline</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="install.html">
  Installation
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="beginner-tutorial.html">
  Tutorial
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="bundles.html">
  Data
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="current reference internal nav-link" href="#">
  Trading Calendars
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="risk-and-perf-metrics.html">
  Metrics
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="api-reference.html">
  API
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="releases.html">
  Releases
 </a>
</li>

    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://ml4trading.io">ML for Trading<i class="fas fa-external-link-alt"></i></a>
    </li>
    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://exchange.ml4trading.io">Community<i class="fas fa-external-link-alt"></i></a>
    </li>
    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/stefan-jansen/zipline-reloaded" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/ml4trading" rel="noopener" target="_blank" title="Twitter">
            <span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-is-a-trading-calendar">
   What is a Trading Calendar?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#why-should-you-care-about-trading-calendars">
   Why Should You Care About Trading Calendars?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-tradingcalendar-class">
   The TradingCalendar Class
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#building-a-custom-trading-calendar">
   Building a Custom Trading Calendar
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusions">
   Conclusions
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="trading-calendars">
<span id="calendars"></span><h1>Trading Calendars<a class="headerlink" href="#trading-calendars" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-is-a-trading-calendar">
<h2>What is a Trading Calendar?<a class="headerlink" href="#what-is-a-trading-calendar" title="Permalink to this headline">¶</a></h2>
<p>A trading calendar represents the timing information of a single market exchange. The timing information is made up of two parts: sessions, and opens/closes.
This is represented by the Zipline <code class="xref py py-class docutils literal notranslate"><span class="pre">TradingCalendar</span></code> class,
and is used as the parent class for all new <code class="docutils literal notranslate"><span class="pre">TradingCalendar</span></code> classes.</p>
<p>A session represents a contiguous set of minutes, and has a label that is midnight UTC.
It is important to note that a session label should not be considered a specific point in time,
and that midnight UTC is just being used for convenience.</p>
<p>For an average day of the <a class="reference external" href="https://www.nyse.com/index">New York Stock Exchange</a>,
the market opens at 9:30AM and closes at 4PM. Trading sessions can change depending on the exchange, day of the year, etc.</p>
</div>
<div class="section" id="why-should-you-care-about-trading-calendars">
<h2>Why Should You Care About Trading Calendars?<a class="headerlink" href="#why-should-you-care-about-trading-calendars" title="Permalink to this headline">¶</a></h2>
<p>Let’s say you want to buy a share of some equity on Tuesday, and then sell it on Saturday.
If the exchange in which you’re trading that equity is not open on Saturday, then in reality
it would not be possible to trade that equity at that time, and you would have to wait
until some other number of days past Saturday. Since you wouldn’t be able to place
the trade in reality, it would also be unreasonable for your backtest to place a trade on Saturday.</p>
<p>In order for you to backtest your strategy, the dates in that are accounted for in your
<a class="reference external" href="https://www.zipline.io/bundles.html">data bundle</a> and the dates in your <code class="docutils literal notranslate"><span class="pre">TradingCalendar</span></code>
should match up; if the dates don’t match up, then you you’re going to see some errors along the way.
This holds for both minutely and daily data.</p>
</div>
<div class="section" id="the-tradingcalendar-class">
<h2>The TradingCalendar Class<a class="headerlink" href="#the-tradingcalendar-class" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">TradingCalendar</span></code> class has many properties we should be thinking about
if we were to build our own <code class="docutils literal notranslate"><span class="pre">TradingCalendar</span></code> for an exchange. These include properties such as:</p>
<blockquote>
<div><ul class="simple">
<li><p>Name of the Exchange</p></li>
<li><p>Timezone</p></li>
<li><p>Open Time</p></li>
<li><p>Close Time</p></li>
<li><p>Regular &amp; Ad hoc Holidays</p></li>
<li><p>Special Opens &amp; Closes</p></li>
</ul>
</div></blockquote>
<p>And several others. If you’d like to see all of the properties and methods available to you through the <code class="docutils literal notranslate"><span class="pre">TradingCalendar</span></code> API, please take a look at the <a class="reference external" href="https://ml4t.zipline.io/api_reference.html#trading-calendar-api">API Reference</a></p>
<p>Now we’ll take a look at the London Stock Exchange Calendar <code class="xref py py-class docutils literal notranslate"><span class="pre">LSEExchangeCalendar</span></code> as an example below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LSEExchangeCalendar</span><span class="p">(</span><span class="n">TradingCalendar</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Exchange calendar for the London Stock Exchange</span>

<span class="sd">  Open Time: 8:00 AM, GMT</span>
<span class="sd">  Close Time: 4:30 PM, GMT</span>

<span class="sd">  Regularly-Observed Holidays:</span>
<span class="sd">    - New Years Day (observed on first business day on/after)</span>
<span class="sd">    - Good Friday</span>
<span class="sd">    - Easter Monday</span>
<span class="sd">    - Early May Bank Holiday (first Monday in May)</span>
<span class="sd">    - Spring Bank Holiday (last Monday in May)</span>
<span class="sd">    - Summer Bank Holiday (last Monday in May)</span>
<span class="sd">    - Christmas Day</span>
<span class="sd">    - Dec. 27th (if Christmas is on a weekend)</span>
<span class="sd">    - Boxing Day</span>
<span class="sd">    - Dec. 28th (if Boxing Day is on a weekend)</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;LSE&quot;</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">tz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">timezone</span><span class="p">(</span><span class="s1">&#39;Europe/London&#39;</span><span class="p">)</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">open_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">time</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">close_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">time</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">regular_holidays</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HolidayCalendar</span><span class="p">([</span>
      <span class="n">LSENewYearsDay</span><span class="p">,</span>
      <span class="n">GoodFriday</span><span class="p">,</span>
      <span class="n">EasterMonday</span><span class="p">,</span>
      <span class="n">MayBank</span><span class="p">,</span>
      <span class="n">SpringBank</span><span class="p">,</span>
      <span class="n">SummerBank</span><span class="p">,</span>
      <span class="n">Christmas</span><span class="p">,</span>
      <span class="n">WeekendChristmas</span><span class="p">,</span>
      <span class="n">BoxingDay</span><span class="p">,</span>
      <span class="n">WeekendBoxingDay</span>
    <span class="p">])</span>
</pre></div>
</div>
<p>You can create the <code class="docutils literal notranslate"><span class="pre">Holiday</span></code> objects mentioned in <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">regular_holidays(self)</span></code> using
the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/">pandas</a>
module <code class="docutils literal notranslate"><span class="pre">pandas.tseries.holiday.Holiday</span></code>.</p>
<p>Take a look at the <a class="reference external" href="https://github.com/quantopian/zipline/blob/master/zipline/utils/calendars/exchange_calendar_lse.py">LSEExchangeCalendar</a> code above as an example, as well as at the code snippet below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pandas.tseries.holiday</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Holiday</span><span class="p">,</span>
    <span class="n">DateOffset</span><span class="p">,</span>
    <span class="n">MO</span>
<span class="p">)</span>

<span class="n">SomeSpecialDay</span> <span class="o">=</span> <span class="n">Holiday</span><span class="p">(</span>
    <span class="s2">&quot;Some Special Day&quot;</span><span class="p">,</span>
    <span class="n">month</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">day</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
    <span class="n">offset</span><span class="o">=</span><span class="n">DateOffSet</span><span class="p">(</span><span class="n">weekday</span><span class="o">=</span><span class="n">MO</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="building-a-custom-trading-calendar">
<h2>Building a Custom Trading Calendar<a class="headerlink" href="#building-a-custom-trading-calendar" title="Permalink to this headline">¶</a></h2>
<p>Now we’ll build our own custom trading calendar. This calendar will be used for trading assets that can be traded on a 24/7 exchange calendar. This means that it will be open on Monday, Tuesday, Wednesday, Thursday, Friday, Saturday, and Sunday, and the exchange will open at 12AM and close at 11:59PM. The timezone which we’ll use is UTC.</p>
<p>First we’ll start off by importing some modules that will be useful to us.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># for setting our open and close times</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">time</span>
<span class="c1"># for setting our start and end sessions</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="c1"># for setting which days of the week we trade on</span>
<span class="kn">from</span> <span class="nn">pandas.tseries.offsets</span> <span class="kn">import</span> <span class="n">CustomBusinessDay</span>
<span class="c1"># for setting our timezone</span>
<span class="kn">from</span> <span class="nn">pytz</span> <span class="kn">import</span> <span class="n">timezone</span>

<span class="c1"># for creating and registering our calendar</span>
<span class="kn">from</span> <span class="nn">trading_calendars</span> <span class="kn">import</span> <span class="n">register_calendar</span><span class="p">,</span> <span class="n">TradingCalendar</span>
<span class="kn">from</span> <span class="nn">zipline.utils.memoize</span> <span class="kn">import</span> <span class="n">lazyval</span>
</pre></div>
</div>
<p>And now we’ll actually build this calendar, which we’ll call <code class="docutils literal notranslate"><span class="pre">TFSExchangeCalendar</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TFSExchangeCalendar</span><span class="p">(</span><span class="n">TradingCalendar</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  An exchange calendar for trading assets 24/7.</span>

<span class="sd">  Open Time: 12AM, UTC</span>
<span class="sd">  Close Time: 11:59PM, UTC</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The name of the exchange, which Zipline will look for</span>
<span class="sd">    when we run our algorithm and pass TFS to</span>
<span class="sd">    the --trading-calendar CLI flag.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;TFS&quot;</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">tz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The timezone in which we&#39;ll be running our algorithm.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">timezone</span><span class="p">(</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">open_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The time in which our exchange will open each day.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">time</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">close_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The time in which our exchange will close each day.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">time</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="mi">59</span><span class="p">)</span>

  <span class="nd">@lazyval</span>
  <span class="k">def</span> <span class="nf">day</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The days on which our exchange will be open.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">weekmask</span> <span class="o">=</span> <span class="s2">&quot;Mon Tue Wed Thu Fri Sat Sun&quot;</span>
    <span class="k">return</span> <span class="n">CustomBusinessDay</span><span class="p">(</span>
      <span class="n">weekmask</span><span class="o">=</span><span class="n">weekmask</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="conclusions">
<h2>Conclusions<a class="headerlink" href="#conclusions" title="Permalink to this headline">¶</a></h2>
<p>In order for you to run your algorithm with this calendar, you’ll need have a data bundle in which
your assets have dates that run through all days of the week. You can read about how to make your
own data bundle in the section <a class="reference internal" href="bundles.html#new-bundle"><span class="std std-ref">Writing a New Bundle</span></a> of this documentation, or use
the code in <a class="reference external" href="https://github.com/stefan-jansen/zipline-reloaded/blob/master/zipline/data/bundles/csvdir.py">csvdir bundle</a>
for creating a bundle from CSV files.</p>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="bundles.html" title="previous page">Data</a>
    <a class='right-next' id="next-link" href="risk-and-perf-metrics.html" title="next page">Metrics</a>

              </div>
              
          </main>
          

      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-74956955-3', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2020, Quantopian Inc..<br/>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.5.4.<br/>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>